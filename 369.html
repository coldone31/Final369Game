<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>369게임</title> <!-- 창 제목 -->
    <style>
        body {
            display: flex;
            /* flexbox 레이아웃 사용 */
            flex-direction: column;
            /* flex 아이템들을 세로방향으로 배치 */
            align-items: center;
            /* 수직 방향 가운데 정렬 */
            justify-content: center;
            /* 수평 방향 가운데 정렬 */
            height: 100vh;
            /* viewport height(vh)를 100%로 설정하여 화면 전체 차지 */
            margin: 0;
            /* 스크롤바 제거, 페이지 가장자리 여백 추가 안함 */
        }

        button {
            margin: 5px;
            /* 각 버튼 5px 간격 */
            padding: 10px 20px;
            /* 위,아래 10px, 좌,우 20px 간격 */
        }

        .buttons {
            display: flex;
            /* flexbox 레이아웃 사용 */
            margin-top: 10px;
            /* 윗창과 10px 간격 */
        }

        #result {
            font-size: 1.2em;
            /* 글자 크기 1.2배 */
            margin-top: 10px;
            /* 윗창과 10px 간격 */
        }

        #score {
            font-size: 1.2em;
            /* 글자 크기 1.2배 */
            margin-top: 10px;
            /* 윗창과 10px 간격 */
            color: blue;
            /* 파란색 글씨 */
        }
    </style>
</head>

<body>
    <h1><b><ins>369 게임</ins></b></h1> <!-- 게임 제목 표시 -->
    <h4><b><i><ins><mark>규칙: 2초 안에 정답을 맞추어야 함!</mark></ins></i></b></h4> <!-- 게임 규칙 설명 -->
    <h2>
        <div id="number-display">숫자: </div>
    </h2> <!-- 랜덤 숫자 제공하는 창 -->

    <div class="buttons">
        <button id="start-button"><b><mark>게임 시작</mark></b></button> <!-- 게임 시작 버튼 -->
    </div>

    <div class="buttons">
        <button class="clap-button">0 박수</button> <!-- 0박수 버튼 -->
        <button class="clap-button">1 박수</button> <!-- 1박수 버튼 -->
        <button class="clap-button">2 박수</button> <!-- 2박수 버튼 -->
        <button class="clap-button">3 박수</button> <!-- 3박수 버튼 -->
    </div>

    <div id="result"></div> <!-- 결과 창 -->
    <div id="score">점수: 0</div> <!-- 점수 창 -->

    <div class="buttons">
        <button id="end-button" style="display: none;"><b><mark>게임 종료</mark></b></button> <!-- 게임 종료 버튼 -->
    </div>

    <script>
        let score = 0; // 점수를 저장할 변수
        let timer; // 타이버를 저장할 변수
        let isAnswered = false; // 사용자가 답을 제출했는지 여부

        // 0부터 999 사이의 랜덤한 숫자를 생성하는 함수
        const generateRandomNumber = () => Math.floor(1000 * Math.random());

        // 숫자에 포함된 3, 6, 9의 개수를 세는 함수
        const countClaps = (number) => { // 매개변수 number에 대해 작동
            let count = 0; // 0개로 초기화
            let numberStr = number.toString(); // 숫자를 문자열로 변환
            for (let i = 0; i < numberStr.length; i++) { // 자릿수를 순회해서 확인
                let currentNumber = numberStr[i]; // 현재 자리 숫자 가져오기
                if (['3', '6', '9'].includes(numberStr[i])) { // 현재 자리 숫자에 3, 6, 9가 있는지 확인
                    count++; // 있다면 count 1씩 증가
                }
            }
            return count; // 결과 반환
        }

        // 새로운 게임을 시작하는 함수
        const newGame = () => { // 익명의 화살표 함수로 정의, 게임 시작시 호출
            let number = generateRandomNumber(); // 랜덤 숫자 생성
            let clapCount = countClaps(number); // 3, 6, 9의 개수 계산
            document.querySelector('#number-display').textContent = `숫자: ${number}`; // 랜덤으로 생성되고 3, 6, 9 개수까지 확인된 숫자 표시
            document.querySelector('#number-display').dataset.clapCount = clapCount; // 박수 개수 데이터 업데이트
            document.querySelector('#result').textContent = ''; // 결과 메시지 초기화
            isAnswered = false; // 새 게임이 시작되면 답변 여부를 초기화

            timer = setTimeout(timeOut, 2000);
        }

        // 2초 후에 답이 제출되지 않으면 점수를 차감하는 함수
        const timeOut = () => { // 2초의 시간이 흐르는 동안
            if (!isAnswered) { // 답이 제출되지 않으면
                score--; // 점수 1점 감소
                document.querySelector('#result').textContent = '시간 초과! 점수 1점 감소.'; // 시간 초과와 점수 차감 되었다고 알림
                document.querySelector('#result').style.color = 'red'; // 빨간색 글씨
                updateScore();
                setTimeout(newGame, 2000); // 2초 후에 새로운 게임 시작
            }
        }

        // 사용자가 선택한 답을 확인하는 함수
        const checkAnswer = (userAnswer) => { // 매개변수 userAnswer에 대해 작동
            clearTimeout(timer); // 타이머 초기화
            isAnswered = true; // 사용자가 답을 제출했음을 표시
            let correctAnswer = parseInt(document.querySelector('#number-display').dataset.clapCount); // 문자열을 정수로 변환
            // 위에서 숫자를 문자열 데이터로 변환했기 때문에 숫자를 비교하거나 계산하기 위해서는 다시 숫자형 데이터로 변환해야함
            let result = document.querySelector('#result'); // 결과 요소 가져오기
            let message;
            let color;

            // 사용자 답과 정답을 비교하여 결과를 표시하고 점수를 업데이트
            if (userAnswer === correctAnswer) { // 사용자가 선택한 답과 정답이 일치하면
                message = '정답입니다!'; // 정답이라고 알림
                color = 'green'; // 초록색 글씨
                score++; // 점수 1점 증가
            } else { // 사용자가 선택한 답과 정답이 일치하지 않으면
                message = `오답입니다. 정답은 ${correctAnswer} 박수입니다.`; // 오답과 정답을 알림
                color = 'red'; // 빨간색 글씨
                score--; // 점수 1점 감소
            }

            // 결과 메시지와 색상을 업데이트
            result.textContent = message; // 메시지 표시 (정답 또는 오답 메시지)
            result.style.color = color; // 텍스트 색상을 설정 (정답:초록색, 오답:빨간색)

            // 점수를 표시
            updateScore();

            // 2초 후에 새로운 게임 시작
            setTimeout(newGame, 2000);
        }

        // 게임을 초기화하는 함수
        const resetGame = () => {
            score = 0; // 점수 초기화
            document.querySelector('#number-display').textContent = '숫자: '; // 숫자 초기화
            document.querySelector('#result').textContent = ''; // 결과 초기화
            updateScore(); // 점수 업데이트
        }

        // 게임을 시작하는 함수
        const startGame = () => {
            newGame(); // 새로운 게임 시작
            document.querySelector('#start-button').style.display = 'none'; // 게임 시작 버튼 숨기기
            document.querySelector('#end-button').style.display = 'block'; // 게임 종료 버튼 표시
        }

        // 게임을 종료하는 함수
        const endGame = () => {
            clearTimeout(timer); // 타이머 초기화
            resetGame(); // 게임 초기화
            document.querySelector('#start-button').style.display = 'block'; // 게임 시작 버튼 표시
            document.querySelector('#end-button').style.display = 'none'; // 게임 종료 버튼 숨기기
            isAnswered = true; // 게임 종료 상태로 변경
        }

        // 점수가 변경될시 업데이트 되는 함수
        const updateScore = () => {
            document.querySelector('#score').textContent = `점수: ${score}`; // 점수 업데이트
        }

        // 게임 시작 버튼 클릭시 실행 이벤트 리스너
        document.querySelector('#start-button').addEventListener('click', startGame);

        // 게임 종료 버튼 클릭시 실행 이벤트 리스너
        document.querySelector('#end-button').addEventListener('click', endGame);

        // 각 박수 버튼 클릭시 실행 이벤트 리스너
        document.querySelectorAll('.clap-button').forEach((button, index) => { // index 매개변수는 각 박수 버튼의 인덱스를 나타냄
            // 각 버튼 요소와 해당 버튼이 배열 내에서 가지는 index를 매개변수로 받음
            button.addEventListener('click', () => { // 버튼이 클릭되었을 때
                checkAnswer(index); // 어떤 박수에 대한 답을 체크해야 하는지 식별
            });
        });
    </script>
</body>

</html>